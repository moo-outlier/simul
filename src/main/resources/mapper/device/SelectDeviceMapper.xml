<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cbm.device.dao.SelectDeviceDAO">

  <select id="getCountDevices" resultType="Integer">
    /* getCountDevices */
    /* 장치 총 갯수 */
    SELECT
      COUNT(*)
    FROM
      MN_DEVICE
    WHERE 1=1
      <if test='deviceCode!=null and !deviceCode.equals("")'>
        AND
          DEVICE_CODE = #{deviceCode}
      </if>
  </select>
  
  <select id="isDeviceCodeDuplicated" parameterType="HashMap" resultType="boolean">
    /* isDeviceCodeDuplicated */
    /* 장치 코드 중복 확인 */
    SELECT
      IF(COUNT(*) > 0, 1, 0)
    FROM
      MN_DEVICE
    WHERE 1=1
    AND 
      DEVICE_CODE IN 
      <foreach collection="devices" item="device" open="(" separator="," close=")">
        #{device.deviceCode}
      </foreach>
  </select>

  <select id="getAllDeviceCodes" resultType="String">
    /* getDeviceCodes */
    /* 장치 코드 전체 조회(코드) */
    SELECT DISTINCT
      DEVICE_CODE
    FROM
      MN_DEVICE
  </select>

  <select id="getAllDevices" resultType="LinkedHashMap">
    /* getAllDevices */
    /* 장치 코드 전체 조회(테이블) */
    SELECT
      DEVICE_CODE AS deviceCode,
      DEVICE_NM AS deviceNm,
      MAKER_NM AS makerNm,
      DEVICE_NOTE AS deviceNote
    FROM
      MN_DEVICE
    WHERE 1=1
    <if test='deviceCode!=null and !deviceCode.equals("")'>
      AND
        DEVICE_CODE = #{deviceCode}
    </if>
    ORDER BY
      DEVICE_PID
    <if test='recordSize!=null and !recordSize.equals("")
              and startNo!=null and !startNo.equals("")'>
      LIMIT #{recordSize} OFFSET #{startNo}
    </if>
  </select>
  
  <select id="getDeviceByCode" parameterType="HashMap" resultType="HashMap">
    /* getDeviceByCode */
    /* 장치 코드로 장치 단일 조회 */
    SELECT
      DEVICE_CODE AS deviceCode,
      DEVICE_NM AS deviceNm,
      MAKER_NM AS makerNm,
      DEVICE_NOTE AS deviceNote
    FROM
      MN_DEVICE
    WHERE
      DEVICE_CODE = #{deviceCode}
  </select>

  <select id="getAllDeviceDetail" resultType="LinkedHashMap">
    /* getAllDeviceDetail */
    /* 장치 코드 상세 정보 전체 조회 */
    SELECT
      DEVICE_CODE AS deviceCode,
      DEVICE_NM AS deviceNm,
      BYTE_AT AS byteAt,
      BYTE_ID AS byteId,
      BIT_ID AS bitId,
      DATA_LNGTH AS dataLngth,
      DATA_TYPE AS dataType
    FROM
      MN_DEVICE_DETAIL
    ORDER BY
      DEVICE_DETAIL_PID
    LIMIT #{recordSize} OFFSET #{startNo}
  </select>

  <select id="getDeviceDetailByCode" parameterType="HashMap" resultType="HashMap">
    /* getDeviceDetailByCode */
    /* 장치 코드로 장치 상세 정보 단일 조회 */
    SELECT
      DEVICE_CODE AS deviceCode,
      DEVICE_NM AS deviceNm,
      BYTE_AT AS byteAt,
      BYTE_ID AS byteId,
      BIT_ID AS bitId,
      DATA_LNGTH AS dataLngth,
      DATA_TYPE AS dataType
    FROM
      MN_DEVICE_DETAIL
    WHERE
      DEVICE_CODE = #{deviceCode}
  </select>

</mapper>