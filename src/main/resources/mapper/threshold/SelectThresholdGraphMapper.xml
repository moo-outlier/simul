<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cbm.threshold.dao.SelectThresholdGraphDAO">

  <sql id="whereGetThresholdGraph">
    <where>
      1=1
      <if test='pvUnqcode != null and !pvUnqcode.equals("")'>
--    편성고유코드
        AND PV_UNQCODE = #{pvUnqcode}
      </if>
      <if test='deviceCode != null and !deviceCode.equals("")'>
--    장치코드
        AND DEVICE_CODE = #{deviceCode}
      </if>
      <if test='startDe != null and !startDe.equals("") and endDe != null and !endDe.equals("")'>
--    발생시각
        AND OCRNC_AT BETWEEN #{startDe} AND #{endDe}
      </if>
    </where>
  </sql>

  <select id="getThresholdGraphList" resultType="cmmcloud.data.CamelLinkedHashMap">
--  getThresholdGraphList
--  임계치 진단 결과 그래프 목록 조회
    SELECT
      PV_UNQCODE,
      DEVICE_UNQNO,
      DEVICE_CODE,
      CAR_SE_CODE,
      DEVICE_NM,
      WARN_THRHLD_SE_CODE,
      WARN_RT,
      STRANGE_THRHLD_SE_CODE,
      STRANGE_RT,
      DATE_FORMAT(OCRNC_AT, '%Y-%m-%d %H:%i:%s') AS OCRNC_AT
    FROM MN_THRHLD_RESULT_GRAPH
    <include refid="whereGetThresholdGraph"/>
    ORDER BY OCRNC_AT DESC
  </select>

  <select id="getThresholdResultList" resultType="cmmcloud.data.CamelLinkedHashMap">
--  getThresholdResultList
--  임계치 진단 결과 테이블 조회
    SELECT
      *
    FROM MN_THRHLD_RESULT
    ORDER BY OCRNC_AT DESC
    LIMIT 50
  </select>

</mapper>